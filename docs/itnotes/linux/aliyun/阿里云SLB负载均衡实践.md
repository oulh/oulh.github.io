---
title: 阿里云SLB负载均衡实践
date: 2020-10-21
---

[阿里云SLB负载均衡](https://developer.aliyun.com/article/773840)

过程：

1. 配置负载均衡SLB的监听规则，并将ECS实例部署到SLB后端；
1. 通过设置负载均衡SLB后端服务器ECS的权重值，分配用户访问后端ECS实例的比例。
### 设置负载均衡服务器
> 将两台服务器挂载到负载均衡的后端，这样，用户只需访问一个IP地址或域名，负载均衡服务器将会根据权重自动转发用户请求到相应的后端服务器上。

1. 在阿里云控制台中打开负载均衡

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925200919.png)

2. 点击左侧的 **实例管理** ，然后打开实验提供的实例，在实例列表页面，点击目标实例右侧的 **点我开始配置** 。

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925201213.png)

3. 通过负载均衡业务配置向导，配置负载均衡的 **监听端口**、**后端服务器** 和 **健康检查** ：

1）在 **协议&监听** 页面，输入如下信息，完成后，点击 **下一步** 。

- 负载均衡协议：选择 **HTTP**
- 监听端口：设为 **80**
- 高级配置保持默认
![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925201549.png)

2）在 **后端服务器** 页面，监听请求转发至 **默认服务器组**，在已添加服务器处点击 **继续添加**

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925201803.png)
3）在弹出的待添加服务器页面，在预先配置好的两台云服务器前打勾选择，然后点击**下一步**，之后再点击 **添加**；

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925202025.png)
4)在后端服务器界面的已添加服务器列表中，可以看到新增的两台云服务器，分别将 **端口** 设置为 **80**，并点击 **下一步** 。

说明：负载均衡器将会按照输入的权重比例分发请求。

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925202409.png)

5）在 **健康检查** 配置中，开启健康检查按钮为绿色 **开启状态**，点击 **下一步**。

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925202559.png)

6)在 **配置审核** 页面，确认上述配置操作正确，点击 **提交**

7）此时，页面将显示一个状态为 **运行中** 的负载均衡监听实例，后端服务器组已添加完成两台ECS服务器，且 **健康检查** 的状态为 **正常**。

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925203133.png)

### 测试
​	此时，两台后端服务器的权重比例相同。

1. 在控制台点击左侧 **实例管理** ，在右侧页面中的红框处看到负载均衡的 **服务地址**（也就是 **云产品资源** 提供的 **负载均衡** 的 **IP地址**） ；

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925203828.png)

2. 在浏览器中新建页面，并访问 **负载均衡** 的 **服务地址** ；反复刷新页面，负载均衡会将用户的请求发送到后端不同的服务器进行处理。
#### 修改后端服务器权重
		修改后端服务器权重，验证负载均衡向后端服务器发送请求的比例是按照权重的比例调整的。

1. 返回 **实例管理** 页面，点击该实例的 **默认服务器组** ；

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925204420.png)

2. 选中 **已添加的服务器** ，列表中，勾选下方的勾选框 ，然后点击 **修改权重** ；

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925204524.png)

3. 弹出对话框中，勾选 **设置不同的权重** 。
3. 设置两个实例的 **权重** 分别为 **30** ，**90** 。

说明：通过如上的权重配置，用户通过负载均衡访问的时候，1/4 的用户请求发送到一台后端服务器中，3/4 的请求发送到另一台后端服务器中。

5. 完成如上配置后，点击 **确定** ，生效配置信息。

![img](https://leo-1258140835.cos.ap-guangzhou.myqcloud.com/blogimages/20200925204659.png)
